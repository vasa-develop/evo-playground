"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[602],{74602:function(e,t,r){r.r(t),r.d(t,{default:function(){return components_MoleculeViewer}});var n=r(57437),i=r(2265),l=r(61935),u=r(57499),a=r(50921),o=r(84698),s=r(1579),c=r(80941),d=r(43639);r(43631);let SequenceViewerWithControls=e=>{let{sequence:t,onAminoAcidClick:r,onAminoAcidHover:l,clickedResidue:u,hoveredResidue:a}=e,o=t.match(RegExp(".{1,".concat(60,"}"),"g"))||[],renderNumbering=e=>{let r=[],i=60*e,l=Math.min((e+1)*60,t.length);for(let e=i;e<=l;e+=10)e<=t.length&&e!=i&&r.push((0,n.jsx)("span",{style:{position:"absolute",left:"".concat((e-1)%60*11+55*Math.floor((e-1-i)/10)+10/6*Math.floor((e-1-i)/10),"px"),fontSize:"10px",color:"#888",width:"30px",textAlign:"center"},children:e},e));return r};return(0,n.jsx)("div",{style:{padding:"10px",fontFamily:"monospace",maxWidth:"100%",overflowX:"auto"},children:o.map((e,t)=>(0,n.jsxs)("div",{style:{marginBottom:"5px",position:"relative"},children:[(0,n.jsx)("div",{style:{height:"15px",marginBottom:"2px",position:"relative"},children:renderNumbering(t)}),(0,n.jsx)("div",{style:{whiteSpace:"nowrap"},children:e.split("").map((e,u)=>{let o=60*t+u;return(0,n.jsxs)(i.Fragment,{children:[0!==u&&u%10==0&&(0,n.jsx)("span",{style:{padding:"0 5px"},children:"\xa0\xa0\xa0\xa0\xa0"}),(0,n.jsx)("span",{onClick:()=>r(o),onMouseEnter:()=>l(o),onMouseLeave:()=>l(null),style:{cursor:"pointer",padding:"2px",backgroundColor:a===o?"#B280FF":o%2==0?"#f0f0f0":"white",transition:"background-color 0.3s"},children:e},o)]},o)})})]},t))})};var h=r(36391);let transformSequence=e=>{let t=e.split("\n")[1];return t.replace(/[^A-Z]/g,"")};var components_MoleculeViewer=e=>{let{pdbStr:t,sequence:r}=e,p=(0,i.useRef)(null),f=(0,i.useRef)(null),g=(0,i.useRef)(null),[m,v]=(0,i.useState)(null),[x,b]=(0,i.useState)(null);r=transformSequence(r),(0,i.useEffect)(()=>{if(!p.current||!f.current)return;let initViewer=async()=>{if(g.current=new l.Z((0,u.u)()),await g.current.init(),f.current&&p.current){var e;g.current.initViewer(f.current,p.current),null===(e=g.current.canvas3d)||void 0===e||e.setProps({camera:{helper:{axes:{name:"off",params:{}}}}});let r=await g.current.builders.data.rawData({data:t,label:void 0}),n=await g.current.builders.structure.parseTrajectory(r,"pdb");await g.current.builders.structure.hierarchy.applyPreset(n,"default")}g.current.behaviors.interaction.hover.subscribe(e=>{if("element-loci"===e.current.loci.kind){var t;let r=e.current.loci,n=r.elements[0],i=n.unit,l=h.hU.getAt(n.indices,0),u=g.current.state.data.select(o.tE.Generators.rootsOfType(s.G.Molecule.Structure))[0],c=null==u?void 0:null===(t=u.obj)||void 0===t?void 0:t.data;if(!c)return;let d=a.G$.Location.create(c,i,l),p=a.StructureProperties.residue.label_seq_id(d);b(p-1)}else b(null)})};return initViewer(),()=>{var e;null===(e=g.current)||void 0===e||e.dispose()}},[t]);let focusOnResidue=e=>{var t;if(!g.current)return;let r=g.current.state.data.select(o.tE.Generators.rootsOfType(s.G.Molecule.Structure))[0];if(!r)return;let n=null===(t=r.obj)||void 0===t?void 0:t.data;if(!n)return;let i=a.G$.Location.create(n),l=(0,c.AO)(),u=!1;if(n.units.forEach(t=>{let r=t.elements;for(let n=0;n<r.length;n++){i.unit=t,i.element=r[n];let o=a.StructureProperties.residue.label_seq_id(i);if(o===e+1){a.G$.Location.position(l,i),u=!0;break}}return!u}),u){let e=d.CP.create(l,5);g.current.managers.camera.focusSphere(e,{durationMs:250})}},highlightResidue=e=>{var t;if(!g.current)return;let r=g.current.state.data.select(o.tE.Generators.rootsOfType(s.G.Molecule.Structure))[0];if(!r)return;let n=null===(t=r.obj)||void 0===t?void 0:t.data;if(!n)return;if(null===e&&null===m){g.current.managers.interactivity.lociHighlights.clearHighlights(),g.current.managers.structure.focus.clear();return}let i=a.G$.Location.create(n),l=[];n.units.forEach(t=>{let r=t.elements;for(let n=0;n<r.length;n++){i.unit=t,i.element=r[n];let u=a.StructureProperties.residue.label_seq_id(i);u===(null!==e?e+1:m+1)&&l.push({unit:t,indices:h.hU.ofSingleton(r[n])})}});let u=a.G$.Loci(n,l);g.current.managers.interactivity.lociHighlights.highlightOnly({loci:u}),g.current.managers.structure.focus.setFromLoci(u)};return(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsx)(SequenceViewerWithControls,{sequence:r,onAminoAcidClick:e=>{v(e),focusOnResidue(e)},onAminoAcidHover:e=>{null!==e&&v(null),highlightResidue(e),b(e)},clickedResidue:m,hoveredResidue:x}),(0,n.jsx)("div",{ref:p,style:{position:"relative",width:"100%",height:"620px",marginTop:"20px"},children:(0,n.jsx)("canvas",{ref:f,style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"transparent"}})})]})}}}]);